#!/usr/bin/env node
const { existsSync } = require('fs');
const yargs = require('yargs');

const argv = yargs
  .help('h')
  .usage('Usage: $0 <svgfile> [options]')
  .example(
    '$0 -f input.svg -o out.geojson -p -b -115.9 37.2 -115.7 37.3',
    'Convert svg to geojson'
  )
  .option('bbox', {
    alias: 'b',
    describe: 'BBox in minX minY maxX maxY order',
    default: [-180, -85.051129, 180, 85.051129],
    nargs: 4,
    demandOption: true,
    type: 'array'
  })
  .option('file', {
    alias: 'f',
    describe: 'SVG target file',
    normalize: true,
    demandOption: true,
    type: 'string'
  })
  .option('output', {
    alias: 'o',
    describe: 'Output geojson file',
    normalize: true,
    default: 'output.geojson',
    type: 'string'
  })
  .option('step', {
    alias: 's',
    describe: 'Set interval in pixels between points in curves',
    type: 'number',
    default: 1
  })
  .option('truncate', {
    alias: 't',
    describe: 'Truncates the precision of the output geometry',
    type: 'number',
    default: false
  })
  .option('pretty', {
    alias: 'p',
    describe: 'Prettify output geojson',
    type: 'boolean',
    default: false
  })
  .alias('v', 'version')
  .alias('h', 'help')
  .demandOption(['bbox'])
  .check(argv => {
    if (!existsSync(argv.file)) {
      throw new Error('Input svg file is not a readable file');
    } else if (argv.bbox.some(isNaN)) {
      throw new Error('BBox must contains numbers only');
    }
    return true;
  }).argv;

require('../src/cli')(argv);
